# Configuration

The recommended way to configure jj-spr is to run `jj spr init`, rather than setting config values manually. You can rerun `jj spr init` to update config at any time.

## Configuration Storage

> ℹ️ **Configuration System:** jj-spr primarily uses Jujutsu's native configuration system, but can fall back to Git config for certain values.

**How it works:**
- `jj spr init` writes configuration to your **Jujutsu config** using `jj config set`.
- At runtime, jj-spr reads from **Jujutsu config** first, then falls back to **Git config** for compatibility.

**Configuration priority (highest to lowest):**
1. Command-line flags (e.g., `--github-repository`)
2. Jujutsu repository config (`.jj/repo/config.toml`)
3. Jujutsu user config (`~/.jjconfig.toml`)
4. Git repository config (`.git/config`)
5. Environment variables (e.g., `GITHUB_TOKEN`)
6. Built-in defaults

## Configuration Values

jj-spr uses the following configuration values:

| config key           | CLI flag                          | description                                                                         | default[^default] | default in `jj spr init`[^initdefault]        |
| -------------------- | --------------------------------- | ----------------------------------------------------------------------------------- | ----------------- | --------------------------------------------- |
| `githubAuthToken`    | `--github-auth-token`[^cli-token] | The GitHub PAT (personal authentication token) to use for accessing the GitHub API. |                   |                                               |
| `githubRemoteName`   |                                   | Name of the git remote in this local repository that corresponds to GitHub          | `origin`          | `origin`                                      |
| `githubRepository`   | `--github-repository`             | Name of repository on github.com in `owner/repo` format                             |                   | extracted from the URL of the GitHub remote   |
| `githubMasterBranch` |                                   | The name of the centrally shared branch into which the pull requests are merged     | `main`            | taken from repository configuration on GitHub |
| `branchPrefix`       | `--branch-prefix`                 | String used to prefix autogenerated names of pull request branches                  |                   | `spr/GITHUB_USERNAME/`                        |

Notes:
- All config keys are in the `spr` section; for example, `spr.githubAuthToken`.
- Values passed on the command line take precedence over values set in configuration.

## Setting Configuration

### Option 1: Using jj spr init (Recommended)

The easiest way to configure jj-spr:

```shell
jj spr init
```

This writes settings to your Jujutsu config.

### Option 2: Using jj config set

If you want to manually set configuration:

```shell
# Set repository-specific config (highest priority)
jj config set --repo spr.githubAuthToken "your-token"

# Set user-specific config (applies to all repos)
jj config set --user spr.branchPrefix "my-prefix/"
```

### Option 3: Using git config commands

jj-spr also falls back to git config if a value is not found in Jujutsu config:

```shell
# Set configuration values in git
git config spr.githubAuthToken "your-token"
```

## Jujutsu-Specific Configuration

In addition to jj-spr settings, you may want to configure Jujutsu itself for optimal workflow:

```toml
[revset-aliases]
# Useful revsets for jj-spr workflow
'mine' = 'author(exact:"your.email@example.com")'
'has-pr' = 'mine & description(regex:"Pull Request:")'

[templates]
# Custom log format showing PR numbers
'log' = '''
label(if(current_working_copy, "bold"),
  concat(
    separate(" ",
      label("cyan", change_id.shortest(8)),
      label("magenta", if(description, description.first_line(), "(no description)"))
    ),
    if(description.match("Pull Request: .*(#\\d+)"),
      label("green", " " ++ description.match("Pull Request: .*(#\\d+)")))
  )
)
'''
```

## Environment Variables

jj-spr also respects certain environment variables:

- `GITHUB_TOKEN`: Can be used instead of configuring `githubAuthToken`
- `JJ_SPR_BRANCH_PREFIX`: Override for `branchPrefix` config

[^default]: Value used by `jj spr` if not set in configuration.
[^initdefault]: Value suggested by `jj spr init` if not previously configured.
[^cli-token]: Be careful using this: your auth token will be in your shell history.
